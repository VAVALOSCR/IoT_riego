<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel IoT - Riego Inteligente</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f3f3;
      margin: 20px;
    }
    h1, h2 {
      color: #2d6a4f;
    }
    .datos {
      font-size: 18px;
      background-color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
      margin-bottom: 20px;
    }
    input, button {
      padding: 8px;
      margin: 5px;
    }
  </style>
</head>
<body>

  <h1>ðŸŒ¿ Panel de Riego Inteligente</h1>

  <div class="datos">
    <p><strong>Humedad del suelo:</strong> <span id="humedadSuelo">--</span> %</p>
    <p><strong>Temperatura:</strong> <span id="temperatura">--</span> Â°C</p>
    <p><strong>Humedad ambiente:</strong> <span id="humedadAmbiente">--</span> %</p>
    <p><strong>Ãšltimo riego:</strong> <span id="ultimoRiego">--</span></p>
  </div>

  <h2>ðŸ§  Enviar comando</h2>
  <input type="text" id="comandoInput" placeholder="Ej: regar ahora">
  <button onclick="enviarComando()">Enviar</button>

  <h2>ðŸ“¤ Exportar datos</h2>
  <button onclick="exportarExcel()">Exportar a Excel</button>

  <script>
    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBlj9eFMKtn5IMm4XcX8kPA3fcVeFJ71TM",
      authDomain: "data-riego.firebaseapp.com",
      databaseURL: "https://data-riego-default-rtdb.firebaseio.com",
      projectId: "data-riego",
      storageBucket: "data-riego.firebasestorage.app",
      messagingSenderId: "793269248007",
      appId: "1:793269248007:web:4d0af04b50877b46e74aa2",
      measurementId: "G-0T2926P2TD"
    };

    firebase.initializeApp(firebaseConfig);

    // Escuchar el Ãºltimo valor en tiempo real
    firebase.database().ref("sensor_logs").limitToLast(1).on("child_added", function(snapshot) {
      const data = snapshot.val();
      document.getElementById("humedadSuelo").textContent = data.humedad_suelo + " %";
      document.getElementById("temperatura").textContent = data.temperatura + " Â°C";
      document.getElementById("humedadAmbiente").textContent = data.humedad_ambiente + " %";
      document.getElementById("ultimoRiego").textContent = data.ultimo_riego;
    });

    // Enviar comando desde la web
    function enviarComando() {
      const comando = document.getElementById("comandoInput").value;
      if (comando.trim() === "") return;

      firebase.database().ref("comando_web").set({
        texto: comando
